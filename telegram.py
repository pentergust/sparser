"""Telegram-–±–æ—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ SPMessages.

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–∞–º SPMessages.
–ù–µ —Å—á–∏—Ç–∞—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ "–Ω–∞–º–µ—Ä–µ–Ω–∏–π" (Intents).

–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –¥–ª—è BotFather
--------------------------

sc - –£—Ä–æ–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
updates - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
notify - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
counter - –°—á—ë—Ç—á–∏–∫–∏ —É—Ä–æ–∫–æ–≤/–∫–∞–±–∏–Ω–µ—Ç–æ–≤
tutorial - –ö–∞–∫ –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
set_class - –ò–∑–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å
intents - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏—è
add_intent - –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ
remove_intents - –£–¥–∞–ª–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ
help - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
info - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ

Author: Milinuri Nirvalen
Ver: 2.2 (sp v5.7)
"""

import asyncio
from datetime import datetime
from os import getenv
from pathlib import Path
from typing import Any, Awaitable, Callable, Dict, Optional, NamedTuple
import sqlite3

from aiogram import Bot, Dispatcher, F
from aiogram.filters import Command, CommandObject
from aiogram.filters.callback_data import CallbackData
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.types import (CallbackQuery, ErrorEvent, InlineKeyboardButton,
                           InlineKeyboardMarkup, Message, Update)
from dotenv import load_dotenv
from loguru import logger

from sp.counters import (cl_counter, days_counter, group_counter_res,
                         index_counter)
from sp.intents import Intent
from sp.messages import SPMessages, send_counter, send_search_res, send_update
from sp.parser import Schedule
from sp.utils import get_str_timedelta


# –ù–∞—Å—Ç—Ä–æ–π–∫–∫–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
# ======================

load_dotenv()
TELEGRAM_TOKEN = getenv("TELEGRAM_TOKEN", "")
dp = Dispatcher()
days_names = ("–ø–Ω", "–≤—Ç", "—Å—Ä", "—á—Ç", "–ø—Ç", "—Å–±")
_TIMETAG_PATH = Path("sp_data/last_update")
DB_CONN = sqlite3.connect("sp_data/tg.db")

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–ª–∞—Å—Å–∞
# pass => –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–º–µ–Ω—É –∫–ª–∞—Å—Å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å None
# cl_features => –°–ø–∏—Å–æ–∫ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –µ—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å
PASS_SET_CL_MARKUP = InlineKeyboardMarkup(
    inline_keyboard=[
        [
            InlineKeyboardButton(text="–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –∫–ª–∞—Å—Å", callback_data="pass"),
            InlineKeyboardButton(text="–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è", callback_data="cl_features"),
        ]
    ]
)
BACK_SET_CL_MARKUP = InlineKeyboardMarkup(
    inline_keyboard=[
        [
            InlineKeyboardButton(text="‚óÅ", callback_data="set_class"),
            InlineKeyboardButton(text="–ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –∫–ª–∞—Å—Å", callback_data="pass"),
        ]
    ]
)


# –í—Å–æ–ø–æ–º–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å
# =====================

class IntentObject(NamedTuple):
    name: str
    intent: Intent

class UserIntents:
    """–•—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –Ø–≤–ª—è–µ—Ç—Å—è –æ–±—ë—Ä—Ç–∫–æ–π –Ω–∞–¥ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç—å, –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        conn (sqlite3.Connection): –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
        uid (int): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞.
    """

    def __init__(self, conn: sqlite3.Connection, uid: int) -> None:
        self._conn = conn
        self._cur = self._conn.cursor()
        self._uid = uid
        self._check_tables()

    def _check_tables(self) -> None:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–º–µ—Ä–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö."""
        self._cur.execute(("CREATE TABLE IF NOT EXISTS intent("
            "user_id TEXT NOT NULL,"
            "name TEXT NOT NULL,"
            "intent TEXT NOT NULL)"
        ))
        self._conn.commit()

    # –†–∞–±–æ—Ç–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –Ω–∞–º–µ—Ä–µ–Ω–∏–π ----------------------------------------------

    def get(self) -> list[IntentObject]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å –≤—Å–µ—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        Return:
            list[InentObject]: –°–ø–∏—Å–æ–∫ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
        """
        self._cur.execute(
            "SELECT name,intent FROM intent WHERE user_id=?",
            (self._uid,)
        )
        return [IntentObject(n, Intent.from_str(i))
            for n, i in self._cur.fetchall()
        ]

    def get_intent(self, name: str) -> Optional[Intent]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏."""
        for x in self.get():
            if x.name == name:
                return x.intent

    def remove_all(self):
        """–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
        self._cur.execute("DELETE FROM intent WHERE user_id=?", (self._uid,))
        self._conn.commit()

    # –†–∞–±–æ—Ç–∞ —Å –æ–¥–Ω–∏–º –Ω–∞–º–µ—Ä–µ–Ω–∏–µ–º ------------------------------------------------

    def add(self, name: str, intent: Intent) -> None:
        """–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

        –î–æ–∞–±–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
        –ï—Å–ª–º —Ç–∞–∫–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ—Ç

        Args:
            name (str): –ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
            intent (Intent): –ù–∞–º–µ—Ä–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.
        """
        int_s = intent.to_str()
        if self.get_intent(name) is not None:
            self._cur.execute(
                "UPDATE intent SET intent=? WHERE user_id=? AND name=?",
                (int_s, self._uid, name)
            )
        else:
            self._cur.execute(
                "INSERT INTO intent(user_id,name,intent) VALUES(?,?,?);",
                (self._uid, name, int_s)
            )
        self._conn.commit()

    def rename(str, old_name: str, new_name: str) -> None:
        """–ò–∑–º–µ–Ω—è–µ—Ç –∏–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

        Args:
            old_name (str): –°—Ç–∞—Ä–æ–µ –∏–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
            new_name (str): –ù–æ–≤–æ–µ –∏–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
        """
        self._cur.execute(
            "UPDATE intent SET name=? WHERE user_id=? AND name=?",
            (new_name, self._uid, old_name)
        )
        self._conn.commit()

    def remove(self, name: str) -> None:
        """–£–¥–∞–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

        Args:
            name (str): –ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.
        """
        self._cur.execute(
            "DELETE FROM intent WHERE user_id=? AND name=?",
            (self._uid, name)
        )
        self._conn.commit()


# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Middleware
# =====================

@dp.message.middleware()
@dp.callback_query.middleware()
async def user_middleware(
    handler: Callable[[Update, Dict[str, Any]], Awaitable[Any]],
    event: Update,
    data: Dict[str, Any],
) -> Any:
    """–î–æ–±–∞–≤–ª—è–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä SPMessages –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫."""
    if isinstance(event, CallbackQuery):
        uid = event.message.chat.id
    else:
        uid = event.chat.id

    data["sp"] = SPMessages(str(uid))
    data["intents"] = UserIntents(DB_CONN, uid)
    return await handler(event, data)

# –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–∞–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
@dp.message.middleware()
@dp.callback_query.middleware()
async def log_middleware(
    handler: Callable[[Update, Dict[str, Any]], Awaitable[Any]],
    event: Update,
    data: Dict[str, Any],
) -> Any:
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –±–æ—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ callback data."""
    if isinstance(event, CallbackQuery):
        logger.info("[c] {}: {}", event.message.chat.id, event.data)
    else:
        logger.info("[m] {}: {}", event.chat.id, event.text)

    return await handler(event, data)


# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
# ============================

# –ì–ª–∞–≤–Ω–µ–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–∫–∏ –±–æ—Ç–∞
HOME_MESSAGE = ("üí° –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:"
    "\n-- 7–≤ 6–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"
    "\n-- —É—Ä–æ–∫–∏ 6–∞ –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫ —Å—Ä"
    "\n-- 312 –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫ –ø—è—Ç–Ω–∏—Ü—É"
    "\n-- —Ö–∏–º–∏—è 228 6–∞ –≤—Ç–æ—Ä–Ω–∏–∫"
    "\n\nüè´ –í –∑–∞–ø—Ä–æ—Å–∞—Ö –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:"
    "\n* –£—Ä–æ–∫/–ö–∞–±–∏–Ω–µ—Ç: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è."
    "\n* –ö–ª–∞—Å—Å—ã: –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ."
    "\n* –î–Ω–∏ –Ω–µ–¥–µ–ª–∏:"
    "\n-- –ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ —É–∫–∞–∑–∞–Ω - –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞."
    "\n-- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-—Å—É–±–±–æ—Ç–∞ (–ø–Ω-—Å–±)."
    "\n-- –°–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –Ω–µ–¥–µ–ª—è."
    "\n\nüåü –ö–∞–∫ –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã? /tutorial"
)

# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª–∞—Å—Å–∞
SET_CLASS_MESSAGE = ("–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤–∞—à –∫–ª–∞—Å—Å."
    "\n–í—ã —Å–º–æ–∂–µ—Ç–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è."
    "\n–ü–æ—á–∏—Ç–∞—Ç—å –æ –≤—Å–µ—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö - /cl_features"
    "\n\nüåü –ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏—Ç–µ –∫–ª–∞—Å—Å —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–º (\"8–≤\")"
    "\n–ò–ª–∏ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /set_class (–ø—Ä–∏–º. /set_class 7–≤)"
    "\n\n–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É (/pass)."
    "\n\nüí° –í—ã –º–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å –ø–æ–∑–∂–µ:"
    "\n-- —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /set_class [–∫–ª–∞—Å—Å]."
    "\n-- –ï—â—ë -> —Å–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å."
)

# –ö–∞–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–ª—É—á–∞–µ—Ç —É–∫–∞–∑–∞–≤–≥–∏—Ö –∫–ª–∞—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
CL_FEATURES_MESSAGE = ("üåü –ï—Å–ª–∏ –≤—ã —É–∫–∞–∂–µ—Ç–µ –∫–ª–∞—Å—Å, —Ç–æ —Å–º–æ–∂–µ—Ç–µ:"
    "\n\n-- –ë—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞, –∫–Ω–æ–ø–∫–æ–π –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é."
    "\n-- –ù–µ —É–∫–∑–∞—ã–≤–∞—Ç—å –≤–∞—à –∫–ª–∞—Å—Å –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–ø—Ä–∏–º. \"–ø–Ω\")."
    "\n-- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ä–∞—Å—Å—ã–ª–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞."
    "\n-- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞."
    "\n-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫ cl/lessons."
    "\n\nüíé –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –º–æ–∂–µ—Ç –ø–æ–ø–æ–ª–Ω—è—Ç—å—Å—è."
)

# –°–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏ -----------------------------------------------

INTENTS_INFO_MESSAGE = ("–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∞—à–∏–º–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏."
    "\n–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞."
    "\n–ù–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π."
)

SET_INTENT_NAME_MESSAGE = ("‚úèÔ∏è –¢–µ–ø–µ—Ä—å –¥–∞–π—Ç–µ –∏–º—è –≤–∞—à–µ–º—É –Ω–∞–º–µ—Ä–µ–Ω–∏—é."
    "\n–ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ."
    "\n–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3-—Ö –¥–æ 15-—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤."
    "\n\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /cancel —á—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è."
)

PARSE_INTENT_MESSAGE = ("‚úèÔ∏è –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —É–∫–∞–∂–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–º–µ—Ä–µ–Ω–∏—è."
    "\n–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –≤–∞—à–µ–º –Ω–∞–º–µ—Ä–µ–Ω–∏–∏."
    "\n–≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–ª–∞—Å—Å—ã, –¥–Ω–∏, —É—Ä–æ–∫–∏, –∫–∞–±–∏–Ω–µ—Ç—ã."
    "\n–í—Å—ë –∫–∞–∫ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é."
    "\n\nüî∂ –ü—Ä–∏–º–µ—Ä:"
    "\n-- –≤—Ç–æ—Ä–Ω–∏–∫ –º–∞—Ç–µ–º"
    "\n-- 9–≤ 312"
    "\n\nüåü /tutorial - –°–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
    "\n/cancel - –û—Ç–º–µ–Ω–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è"
)

INTENTS_REMOVE_MANY_MESSAGE = ("üóëÔ∏è –†–µ–∂–∏–º —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
    "\n–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –µ–≥–æ."
    "\n–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤–∞—à–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π."
    "\n\n–ù–∞–∂–º–∏—Ç–µ \"–∑–∞–≤–µ—Ä—à–∏—Ç—å\" –∫–∞–∫ –Ω–∞–∏–≥—Ä–∞–∏—Ç–µ—Å—å."
)

INTENTS_LIMIT_MESSAGE = ("‚ö†Ô∏è –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ø—Ä–µ–¥–µ–ª–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
    "\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ —É–¥–∞–ª–∏—Ç–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è."
    "\n\n/remove_intents - –†–µ–∂–∏–º—ã –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è"
    "\n–ò–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ."
)


# –°–æ–æ–±—â–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
TUTORIAL_MESSAGES = [
    ("üí° –ö–∞–∫ –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã?"
        "\n–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤—Å—ë –Ω–∞–º–Ω–æ-–æ-–æ–≥–æ –ª–µ–≥—á–µ."
        "\n–ü—Ä–æ–π–¥–∏—Ç–µ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —Å–∞–º–∏."
        "\n\n–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –æ–±—É—á–µ–Ω–∏–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞."
        "\n–ò–ª–∏ –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –µ–≥–æ."
    ),

    ("1. –ë—É–¥—å—Ç–µ –ø—Ä–æ—â–µ"
        "\n\n–°–æ–≤—Å–µ–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö \"–ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ\" —Å–ª–æ–≤–∞."
        "\n–¢–∞–∫–∏–µ –∫–∞–∫ \"—É—Ä–æ–∫–∏ –Ω–∞\", \"—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ\", \"–¥–ª—è\" –∏ –ø–æ–¥–æ–±–Ω—ã–µ."
        "\n–û–Ω–∏ –Ω–∏–∫–∞–∫ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Å–∞–º –∑–∞–ø—Ä–æ—Å."
        "\n\n‚ùå —É—Ä–æ–∫–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"
        "\n‚úÖ –ó–∞–≤—Ç—Ä–∞"
        "\n\n‚ùå –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 9–≤ –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫"
        "\n‚úÖ 9–≤ –≤—Ç–æ—Ä–Ω–∏–∫"
        "\n\n–ü–æ—Ä—è–¥–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ."
        "\n-- –º–∞—Ç–µ–º 8–≤ = 8–≤ –º–∞—Ç–µ–º"
    ),

    ("2. –ö–ª–∞—Å—Å—ã"
        "\n\n–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π –∫–ª–∞—Å—Å."
        "\n–ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ —É–∫–∞–∑–∞–Ω, –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞."
        "\nüî∏ –ù–∞ —Å–µ–≥–æ–¥–Ω—è - –µ—Å–ª–∏ —É—Ä–æ–∫–∏ –µ—â—ë –∏–¥—É—Ç."
        "\nüî∏ –ù–∞ –∑–∞–≤—Ç—Ä–∞ - –µ—Å–ª–∏ —É—Ä–æ–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –∫–æ–Ω—á–∏–ª–∏—Å—å."
        "\n\n-- 7–∞ ‚ûú –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è 7–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞."
        "\n-- 7–≥ 6–∞ ‚ûú –°—Ä–∞–∑—É –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤."
        "\n\nüîé –¢–∞–∫–∂–µ –∫–ª–∞—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–æ–∏—Å–∫–µ:"
        "\n\n- —Ö–∏–º–∏—è 8–± ‚ûú –í—Å–µ —É—Ä–æ–∫–∏ —Ö–∏–º–∏–∏ –¥–ª—è 9–±."
        "\n- 9–≤ 312 ‚ûú –í—Å–µ —É—Ä–æ–∫–∏ –≤ 312 –∫–∞–±–∏–Ω–µ—Ç–µ –¥–ª—è 9–≤"
        "\n\nüí° –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –º–æ–∂–Ω–æ –≤ —Å—Ç–∞—Ç—É—Å–µ:"
        "\n-- –ü–æ –∫–Ω–æ–ø–∫–µ \"–µ—â—ë\" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é."
        "\n-- –ü–æ –∫–æ–º–∞–Ω–¥–µ /info"
    ),

    ("3. –î–Ω–∏ –Ω–µ–¥–µ–ª–∏"
        "\n\n–í—ã –º–æ–∂–µ—Ç–µ –±–æ–ª–µ–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –ø–æ–∏—Å–∫–µ."
        "\n–ï—Å–ª–∏ —É–∫–∞–∑–∞–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ–Ω—å, —Ç–æ –ø–æ–ª—É—á–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞."
        "\n\n‚úèÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:"
        "\n-- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - —Å—É–±–±–æ—Ç–∞."
        "\n-- –ø–Ω - —Å–±."
        "\n-- –°–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –Ω–µ–¥–µ–ª—è."
        "\n\n-- –≤—Ç ‚ûú –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫."
        "\n\n–ù–∞–ø–æ–º–Ω–∏–º –ø—Ä–æ \"–±—ã—Ç—å –ø—Ä–æ—â–µ\":"
        "\n‚ùå –£—Ä–æ–∫–∏ –¥–ª—è 5–≥ –Ω–∞ —Å—Ä–µ–¥—É"
        "\n‚úÖ 5–≥ —Å—Ä–µ–¥–∞"
        "\n\nüîé –ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ —É–∫–∞–∑–∞–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –Ω–µ–¥–µ–ª—é."
        "\n-- –º–∞—Ç–µ–º –≤—Ç ‚ûú –í—Å–µ —É—Ä–æ–∫–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫"
        "\n-- –ø—Ç 312 ‚ûú –í—Å–µ —É—Ä–æ–∫–∏ –≤ 312 –∫–∞–±–∏–Ω–µ—Ç–µ –Ω–∞ –ø—è—Ç–Ω–∏—Ü—É"
    ),

    ("4. –ü–æ–∏—Å–∫ –ø–æ —É—Ä–æ–∫–∞–º"
        "\n\nüîé –£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ –¥–ª—è –µ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏."
        "\n–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –Ω–∞ –Ω–µ–¥–µ–ª—é."
        "\n\n‚úèÔ∏è –í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å, –¥–µ–Ω—å, –∫–∞–±–∏–Ω–µ—Ç –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö."
        "\n\n-- –º–∞—Ç–µ–º ‚ûú –í—Å—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤."
        "\n-- —Ö–∏–º–∏—è –≤—Ç–æ—Ä–Ω–∏–∫ 10–∞ ‚ûú –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫."
        "\n\n‚ö†Ô∏è –ï—Å–ª–∏ –≤–≤–µ—Å—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤, –±—É–¥–µ—Ç –≤–∑—è—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π."
        "\n–ß—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º."
        "\n\nüí° –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–ª–∞—Å—Å—ã –º–æ–∂–Ω–æ –≤ —Å—á—ë—Ç—á–∏–∫–∞—Ö:"
        "\n-- –ü–æ –∫–Ω–æ–ø–∫–µ \"–ï—â—ë\" ‚ûú \"–°—á—ë—Ç—á–∏–∫–∏\""
        "\n-- –ü–æ –∫–æ–º–∞–Ω–¥–µ /counter"
    ),

    ("5. –ü–æ–∏—Å–∫ –ø–æ –∫–∞–±–∏–Ω–µ—Ç–∞–º"
        "\nüîé –£–∫–∞–∂–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç, —á—Ç–æ–±—ã –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç –µ–≥–æ –ª–∏—Ü–∞."
        "\n–ï—Å–ª–∏ –ø—Ä–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –Ω–∞ –Ω–µ–¥–µ–ª—é."
        "\n\n‚úèÔ∏è –í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å, –¥–µ–Ω—å, —É—Ä–æ–∫ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö."
        "\n\n-- 328 ‚ûú –í—Å—ë —á—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ 328 –∫–∞–±–∏–Ω–µ—Ç–µ –∑–∞ –Ω–µ–¥–µ–ª—é."
        "\n-- 312 –ª–∏—Ç–µ—Ä –≤—Ç–æ—Ä–Ω–∏–∫ 7–∞ ‚ûú –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫."
        "\n\n‚ö†Ô∏è –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–±–∏–Ω–µ—Ç–æ–≤, –±—É–¥–µ—Ç –≤–∑—è—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π."
        "\n–ß—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –Ω–µ –±—ã–ª —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º."
        "\n–û–¥–Ω–∞–∫–æ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –ø–æ–∏—Å–∫–µ –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É."
        "\n\nüí° –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–∞–±–∏–Ω–µ—Ç—ã –º–æ–∂–Ω–æ –≤ —Å—á—ë—Ç—á–∏–∫–∞—Ö:"
        "\n-- –ü–æ –∫–Ω–æ–ø–∫–µ \"–ï—â—ë\" ‚ûú \"–°—á—ë—Ç—á–∏–∫–∏\" ‚ûú \"–ü–æ —É—Ä–æ–∫–∞–º\""
        "\n-- –ü–æ –∫–æ–º–∞–Ω–¥–µ /counter ‚ûú \"–ü–æ —É—Ä–æ–∫–∞–º\""
    ),

    ("6. –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã"
        "\n\nüåü –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ —á–∞—Ç–∏–∫."
        "\n–≠—Ç–æ –ø–æ–∑–∞–æ–ª–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≥–æ –±–æ—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º."
        "\n–ö–ª–∞—Å—Å —É—Å—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω –Ω–∞ –≤–µ—Å—å —á–∞—Ç."
        "\n\n/set_class [–∫–ª–∞—Å—Å] - —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Å –≤ —á–∞—Ç–µ."
        "\n–ò–ª–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –∫–ª–∞—Å—Å–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ (9–≤)."
        "\n\n‚úèÔ∏è –ß—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ —á–∞—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /sc [–∑–∞–ø—Ä–æ—Å]"
        "\n–ò–ª–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞."
    ),

    ("üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ–º –æ–±—É—á–µ–Ω–∏—è!"
        "\n–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –≤—Å—ë –æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é."
        "\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –≤–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞."
        "\n–í—ã —É–º–Ω–∏—á–∫–∞. ‚ù§Ô∏è"
    )
]


# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
# =======================

# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ----------------------------------------------------------

def get_other_keyboard(
    cl: Optional[str]=None, home_button: Optional[bool] = True
) -> InlineKeyboardMarkup:
    """–°–æ–±–∏—Ä–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
    –ß—Ç–æ–±—ã —ç—Ç–∏ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –∑–∞–Ω–∏–º–∞–ª–∏ –º–µ—Å—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –∏ –Ω–µ –ø—É–≥–∞–ª–∏
    –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–∞–∑–Ω—ã—Ö –∫–Ω–æ–ø–æ—á–µ–∫.

    Buttons:
        set_class => –°–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å.
        count:lessons:main: => –ú–µ–Ω—é —Å—á—ë—Ç—á–∏–∫–æ–≤ –±–æ—Ç–∞.
        updates:last:0:{cl}: => –ü–æ—Å–ª–µ–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
        tutorial:0 => –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±—â–µ–π —Å–ø—Ä–∞–≤–∫–∏.
        intents => –†–∞–∑–¥–µ–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        home => –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

    Args:
        cl (str, Optional): –ö–ª–∞—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        home_button (bool, optional): –î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –∫–Ω–æ–ø–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞.

    Returns:
        InlineKeyboardMarkup: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞.
    """
    buttons = [
        [
            InlineKeyboardButton(text="–°–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å", callback_data="set_class"),
            InlineKeyboardButton(
                text="üìä –°—á—ë—Ç—á–∏–∫–∏", callback_data="count:lessons:main:"
            ),
            InlineKeyboardButton(
                text="üìú –ò–∑–º–µ–Ω–µ–Ω–∏—è", callback_data=f"updates:last:0:{cl}:"
            ),
        ],
        [
            InlineKeyboardButton(text="üåü –û–±—É—á–µ–Ω–∏–µ", callback_data="tutorial:0"),
            InlineKeyboardButton(text="‚öôÔ∏è –ù–∞–º–µ—Ä–µ–Ω–∏—è", callback_data="intents"),
        ],
    ]

    if home_button:
        buttons[-1].append(InlineKeyboardButton(text="üè† –î–æ–º–æ–π", callback_data="home"))

    return InlineKeyboardMarkup(inline_keyboard=buttons)

def get_main_keyboard(cl: Optional[str]=None) -> InlineKeyboardMarkup:
    """–í–æ–∑—Ä–∞—â–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –±–æ—Ç–∞.

    –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–∞–º—ã–º —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º
    —Ä–∞–∑–¥–µ–ª–∞–º –±–æ—Ç–∞, —Ç–∞–∫–∏–º –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∫–ª–∞—Å—Å–∞ –ø–æ
    —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø–æ–≤—â–µ–µ–Ω–∏–π.

    Buttons:
        other => –í—ã–∑–æ–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        notify => –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        sc:{cl}:today => –ü–æ–ª—É—á–∞–µ–Ω–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è –∫–ª–∞—Å—Å–∞.

    Args:
        cl (str, Optional): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–≤–Ω–æ–≤–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

    Returns:
        InlineKeyboardMarkup: –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –±–æ—Ç–∞.
    """
    if cl is None:
        return get_other_keyboard(cl, home_button=False)

    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üîß –ï—â—ë", callback_data="other"),
                InlineKeyboardButton(text="üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", callback_data="notify"),
                InlineKeyboardButton(
                    text=f"üìö –£—Ä–æ–∫–∏ {cl}", callback_data=f"sc:{cl}:today"
                ),
            ]
        ]
    )

# –î–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤ --------------------------------------------------------

def get_week_keyboard(cl: str) -> InlineKeyboardMarkup:
    """–í–æ–∑—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —É—Ä–æ–∫–æ–≤.
    –¢–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ–º–æ–π –∏ –≤—ã–±–æ—Ä–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏.

    Buttons:
        home => –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.
        sc:{cl}:week => –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–µ–¥–ª—é –¥–ª—è –∫–ª–∞—Å—Å–∞.
        select_day:{cl} => –í—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    Args:
        cl (str, Optional): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–≤–Ω–æ–≤–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

    Return:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º.
    """
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üè†–î–æ–º–æ–π", callback_data="home"),
                InlineKeyboardButton(text="–ù–∞ –Ω–µ–¥–µ–ª—é", callback_data=f"sc:{cl}:week"),
                InlineKeyboardButton(text="‚ñ∑", callback_data=f"select_day:{cl}"),
            ]
        ]
    )

def get_sc_keyboard(cl: str) -> InlineKeyboardMarkup:
    """–í–æ–∑–∞—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —É—Ä–æ–∫–æ–≤.
    –¢–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ–º–æ–π –∏ –≤—ã–±–æ—Ä–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏.

    Buttons:
        home => –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.
        sc:{cl}:today => –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è –∫–ª–∞—Å—Å–∞.
        select_day:{cl} => –í—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    Args:
        cl (str): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–≤–Ω–æ–≤–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

    Return:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º.
    """
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text="üè†–î–æ–º–æ–π", callback_data="home"),
                InlineKeyboardButton(text="–ù–∞ —Å–µ–≥–æ–¥–Ω—è", callback_data=f"sc:{cl}:today"),
                InlineKeyboardButton(text="‚ñ∑", callback_data=f"select_day:{cl}"),
            ]
        ]
    )

def get_select_day_keyboard(cl: str) -> InlineKeyboardMarkup:
    """–í–æ–∑–∞—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—ã–±–æ—Ä–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –≤ —Ä–∞—Å—Å–ø–∏—Å–∞–Ω–∏—è.

    –ú—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏.
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—è —É–∫–∑–∞–∞–Ω—ã–π –∫–ª–∞—Å—Å –≤ –∑–∞–ø—Ä–æ—Å.

    Buttons:
        sc:{cl}:{0..6} => –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —É–∫–∑–∞–∞–Ω–Ω–æ–≥–æ –¥–Ω—è.
        sc:{cl}:today => –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
        sc:{cl}:week => –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é.

    Args:
        cl (str): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–≤–Ω–æ–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±—Ä–∞ –¥–Ω—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
    """
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(text=x, callback_data=f"sc:{cl}:{i}")
                for i, x in enumerate(days_names)
            ],
            [
                InlineKeyboardButton(text="‚óÅ", callback_data="home"),
                InlineKeyboardButton(text="–°–µ–≥–æ–¥–Ω—è", callback_data=f"sc:{cl}:today"),
                InlineKeyboardButton(text="–ù–µ–¥–µ–ª—è", callback_data=f"sc:{cl}:week"),
            ],
        ]
    )

# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ä–∞–∑–¥–µ–ª–æ–≤ ----------------------------------------------------------

def get_notify_keyboard(
    enabled: bool, hours: list[int]
) -> InlineKeyboardMarkup:
    """–í–æ–∑–≤—Ä–∞—â–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–Ω–∏ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
    –°–±—Ä–æ–∏—Å–∏—Ç—å –≤—Å–µ —á–∞—Å—ã —Ä–∞—Å—Å—ã–ª–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    Buttons:
        notify:on:0 => –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–æ—Ç–∞.
        notify:off:0 => –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–æ—Ç–∞.
        notify:reset:0 => –°–±—Ä–æ—Å–∏—Ç—å —á–∞—Å—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ —Ä–∞—Å–ø–∏—Å–Ω–∏—è.
        notify:add:{hour} => –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —á–∞—Å–∞.
        notify:remove:{hour} => –û—Ç–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —á–∞—Å–∞.

    Args:
        enabled (bool): –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        hours (list[int]): –í –∫–∞–∫–æ–π —á–∞—Å —Ä–∞—Å—Å—ã–ª–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
    """
    inline_keyboard = [[InlineKeyboardButton(text="‚óÅ", callback_data="home")]]

    if not enabled:
        inline_keyboard[0].append(
            InlineKeyboardButton(text="üîî –í–∫–ª—é—á–∏—Ç—å", callback_data="notify:on:0")
        )
    else:
        inline_keyboard[0].append(
            InlineKeyboardButton(text="üîï –í—ã–∫–ª—é—á–∏—Ç—å", callback_data="notify:off:0")
        )
        if hours:
            inline_keyboard[0].append(
                InlineKeyboardButton(text="‚ùå –°–±—Ä–æ—Å", callback_data="notify:reset:0")
            )
        hours_line = []
        for i, x in enumerate(range(6, 24)):
            if x % 6 == 0:
                inline_keyboard.append(hours_line)
                hours_line = []

            if x in hours:
                hours_line.append(
                    InlineKeyboardButton(
                        text=f"‚úîÔ∏è{x}", callback_data=f"notify:remove:{x}"
                    )
                )
            else:
                hours_line.append(
                    InlineKeyboardButton(text=str(x), callback_data=f"notify:add:{x}")
                )

        if len(hours_line):
            inline_keyboard.append(hours_line)

    return InlineKeyboardMarkup(inline_keyboard=inline_keyboard)

def get_updates_keyboard(
    page: int, updates: list, cl: Optional[str],
    intents: UserIntents, intent_name: str = ""
) -> InlineKeyboardMarkup:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ —Å–ø–∏—Å–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.
    –¢–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Å –æ–±—â–µ–≥–æ –Ω–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—ã–±–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    Buttons:
        home => –í–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—è –±–æ—Ç–∞.
        updates:back:{page}:{cl} => –ü–µ—Ä–µ—â–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞–∑–∞–¥.
        updates:switch:0:{cl} => –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
        updates:next:{page}:{cl} => –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–ø–µ—Ä—ë–¥.
        updates:last:0:{cl} => –ü–µ—Ä–µ—Ä–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

    Args:
        page (int): –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–ø–∏—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
        updates (list): –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
        cl (str, optional): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.
        intents (UserIntents): –≠–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        intent_name (str, Optional): –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ
            –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    """
    # –±–∞–∑–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
    inline_keyboard = [
        [
            InlineKeyboardButton(text="üè†", callback_data="home"),
            InlineKeyboardButton(
                text="‚óÅ", callback_data=f"updates:back:{page}:{cl}:{intent_name}"
            ),
            InlineKeyboardButton(
                text=f"{page+1}/{len(updates)}",
                callback_data=f"updates:switch:0:{cl}:{intent_name}",
            ),
            InlineKeyboardButton(
                text="‚ñ∑", callback_data=f"updates:next:{page}:{cl}:{intent_name}"
            ),
        ]
    ]

    # –î–æ–ø–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
    for i, x in enumerate(intents.get()):
        if i % 3 == 0:
            inline_keyboard.append([])

        if x.name == intent_name:
            inline_keyboard[-1].append(InlineKeyboardButton(
                text=f"‚úÖ {x.name}", callback_data=f"updates:last:0:{cl}:")
            )
        else:
            inline_keyboard[-1].append(InlineKeyboardButton(
                text=f"‚öôÔ∏è {x.name}", callback_data=f"updates:last:0:{cl}:{x.name}")
            )

    return InlineKeyboardMarkup(inline_keyboard=inline_keyboard)


_COUNTERS = (
    ("cl", "–ü–æ –∫–ª–∞—Å—Å–∞–º"),
    ("days", "–ü–æ –¥–Ω—è–º"),
    ("lessons", "–ü–æ —É—Ä–æ–∫–∞–º"),
    ("cabinets", "–ü–æ –∫–∞–±–∏–Ω–µ—Ç–∞–º"),
)

_TARGETS = (
    ("none", "–ù–∏—á–µ–≥–æ"),
    ("cl", "–ö–ª–∞—Å—Å—ã"),
    ("days", "–î–Ω–∏"),
    ("lessons", "–£—Ä–æ–∫–∏"),
    ("cabinets", "–ö–∞–±–∏–Ω–µ—Ç—ã"),
    ("main", "–û–±—â–µ–µ"),
)

def get_counter_keyboard(cl: str, counter: str, target: str,
    intents: UserIntents, intent_name: Optional[str]=""
) -> InlineKeyboardMarkup:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    –ü–æ–∑–≤–æ–¥—è–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ –≥—Ä—É–ø–ø–∞–º –∏ —Ü–µ–ª—è–º:

    +----------+-------------------------+
    | counter  | targets                 |
    +----------+-------------------------+
    | cl       | days, lessons. cabinets |
    | days     | cl, lessons. cabinets   |
    | lessons  | cl, days, main          |
    | cabinets | cl, days, main          |
    +----------+-------------------------+

    Buttons:
        home => –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≥–ª–∞–≤–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –±–æ—Ç–∞.
        count:{counter}:{target} => –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π —Å—á—ë—Ç—á–∏–∫.

    Args:
        cl (str): –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.
        counter (str): –¢–µ–∫—É—â–∞—è –≥—Ä—É–ø–ø–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤.
        target (str): –¢–µ–∫—É—â–∏–π —Ç–∏–ø –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–∞.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤.
    """
    inline_keyboard = [[
            InlineKeyboardButton(text="‚óÅ", callback_data="home")
        ],
        []
    ]

    for k, v in _COUNTERS:
        if counter == k:
            continue

        inline_keyboard[0].append(
            InlineKeyboardButton(
                text=v,
                callback_data=f"count:{k}:{target}:{intent_name}"
            )
        )

    for k, v in _TARGETS:
        if target == k or counter == k:
            continue

        if k == "main" and counter not in ["lessons", "cabinets"]:
            continue

        if counter in ["lessons", "cabinets"] and k in ["lessons", "cabinets"]:
            continue

        if counter == "cl" and k == "lessons" and not cl:
            continue

        inline_keyboard[1].append(
            InlineKeyboardButton(
                text=v,
                callback_data=f"count:{counter}:{k}:{intent_name}"
            )
        )

    for i, x in enumerate(intents.get()):
        if i % 3 == 0:
            inline_keyboard.append([])

        if x.name == intent_name:
            inline_keyboard[-1].append(
                InlineKeyboardButton(
                    text=f"‚úÖ {x.name}",
                    callback_data=f"count:{counter}:{target}:"
                )
            )
        else:
            inline_keyboard[-1].append(
                InlineKeyboardButton(
                    text=f"‚öôÔ∏è {x.name}",
                    callback_data=f"count:{counter}:{target}:{x.name}"
                )
            )


    return InlineKeyboardMarkup(inline_keyboard=inline_keyboard)

def get_tutorial_keyboard(page: int) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.

    –ò—Å–ø–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –æ–±—É—á–µ–Ω–∏—è.

    Buttons:
        delete_msg => –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.
        tutorual:{page} => –°–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—É—á–µ–Ω–∏—è.

    Args:
        page (int): –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø—Ä–∞–≤–∫–∏.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ —Å–ø—Ä–∞–≤–∫–µ.
    """
    inline_keyboard = []

    # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -> –±–µ–∑ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
    if page == 0:
        inline_keyboard.append([
            InlineKeyboardButton(text="üöÄ –ù–∞—á–∞—Ç—å", callback_data="tutorial:1")
        ])

    # –ö–Ω–æ–ø–∫–µ–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
    elif page != len(TUTORIAL_MESSAGES)-1:
        inline_keyboard.append([
            InlineKeyboardButton(text="‚óÅ", callback_data=f"tutorial:{page-1}"),
            InlineKeyboardButton(text="üåü –î–∞–ª—å—à–µ", callback_data=f"tutorial:{page+1}")
        ])

        for i, x in enumerate(TUTORIAL_MESSAGES[1:-1]):
            if i+1 == page:
                continue
            inline_keyboard.append([InlineKeyboardButton(text=x.splitlines()[0], callback_data=f"tutorial:{i+1}")])

        inline_keyboard.append([InlineKeyboardButton(text="‚ùå –ó–∞–∫—Ä—ã—Ç—å", callback_data="delete_msg")])

    # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è
    else:
        inline_keyboard.append([
            InlineKeyboardButton(text="üéâ –ó–∞–≤–µ—Ä—à–∏—Ç—å", callback_data="delete_msg")
        ])

    return InlineKeyboardMarkup(inline_keyboard=inline_keyboard)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π ----------------------------------------------------------

def get_intents_keyboard(intents: list[IntentObject]) -> InlineKeyboardMarkup:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∂–¥–æ–º—É –Ω–∞–º–µ—Ä–µ–Ω–∏—é.
    –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–º –ª–∏–º–∏—Ç.
    –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.

    Buttons:
        intent:show:{name} => –ü–æ–∫–∑–∞–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–º–µ—Ä–µ–Ω–∏–∏.
        intents:remove_mode => –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.
        intent:add: => –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ.
        home => –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.

    Args:
        intents (list[IntentObject]): –ù–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
    """
    inlene_keyboard = [[]]

    if len(intents):
        for i, x in enumerate(intents):
            if i % 3 == 0:
                inlene_keyboard.append([])

            inlene_keyboard[-1].append(InlineKeyboardButton(
                    text=x.name, callback_data=f"intent:show:{x.name}"
                )
            )

        inlene_keyboard.append([InlineKeyboardButton(
                text="üóëÔ∏è —É–¥–∞–ª–∏—Ç—å", callback_data="intents:remove_mode"
            )
        ])

    if len(intents) < 9:
        inlene_keyboard[-1].append(InlineKeyboardButton(
            text="‚ûï –î–æ–±–∞–≤–∏—Ç—å", callback_data="intent:add:"
            )
        )
    inlene_keyboard[-1].append(
        InlineKeyboardButton(text="üè† –î–æ–º–æ–π", callback_data="home")
    )
    return InlineKeyboardMarkup(inline_keyboard=inlene_keyboard)

def get_edit_intent_keyboard(intent_name: str) -> InlineKeyboardMarkup:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

    –ò—Å–ø–æ–ª–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–≤–æ–∞—Ç–µ–ª—è.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–º–µ—Ä–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç—å –µ–≥–æ.

    Buttons:
        intent:reparse:{name} => –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
        intent:remove:{name} => –£–¥–∞–ª–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ.
        intents => –í–µ—Ä–Ω—É—Ç—Å—è –∫ —Å–ø–∏—Å–∫—É –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    Args:
        intent_name (str): –ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
    """
    return InlineKeyboardMarkup(inline_keyboard=[[
        InlineKeyboardButton(
            text="‚úèÔ∏è –∏–∑–º–µ–Ω–∏—Ç—å", callback_data=f"intent:reparse:{intent_name}"
            )
    ],
    [
        InlineKeyboardButton(text="<", callback_data="intents"),
        InlineKeyboardButton(
            text="üóëÔ∏è —É–¥–∞–ª–∏—Ç—å", callback_data=f"intent:remove:{intent_name}"
        )
    ]])

def get_remove_intents_keyboard(
    intents: list[IntentObject]
) -> InlineKeyboardMarkup:
    """–í–æ–∑–∞—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å –º–Ω–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    Buttons:
        intent:remove_many:{name} => –£–¥–∞–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        intents => –í–µ—Ä–Ω—É—Ç—Å—è –∫ —Å–ø–∏—Å–∫—É –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
        intents:remove_all => –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        intents (list[IntentObject]): –°–ø–∏—Å–æ–∫ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Returns:
        InlineKeyboardMarkup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
    """
    inlene_keyboard = [[]]
    if len(intents):
        for i, x in enumerate(intents):
            if i % 3 == 0:
                inlene_keyboard.append([])
            inlene_keyboard[-1].append(
                InlineKeyboardButton(
                    text=x.name, callback_data=f"intent:remove_many:{x.name}"
                )
            )
        inlene_keyboard.append([
            InlineKeyboardButton(
                text="üóëÔ∏è —É–¥–∞–ª–∏—Ç—å –≤—Å–µ", callback_data="intents:remove_all"
            )
        ])

    inlene_keyboard[-1].append(
        InlineKeyboardButton(text="–ó–∞–≤–µ—Ä—à–∏—Ç—å", callback_data="intents")
    )
    return InlineKeyboardMarkup(inline_keyboard=inlene_keyboard)


# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–æ–æ–±—â–µ–Ω–∏—è
# ======================

def get_intent_status(i: Intent) -> str:
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

    –§–æ—Ä–º–∞—Ç: < {–∫–ª–∞—Å—Å—ã} / {–¥–Ω–∏} / {—É—Ä–æ–∫–∏} / {–∫–∞–±–∏–Ω–µ—Ç—ã} >

    Args:
        i (Intent): –ù–∞–º–µ—Ä–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

    Returns:
        str: –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
    """
    message = "<"

    for group in (i.cl, i.days, i.lessons, i.cabinets):
        for x in group:
            message += f" {x}"
        message += " /"
    message += " >"

    return message

def get_update_timetag(path: Path) -> int:
    """–ü–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —É–¥–∞—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–ª–≤–µ–Ω–∏–π.

    –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è.
    –í—Ä–µ–º—è —É—Å–ø–µ—à–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–∫—Ä–∏–ø—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
    –ï—Å–ª–∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É–¥–µ—Ç –¥–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ —á–∞—Å–∞,
    —Ç–æ —ç—Ç–æ –ø–æ–≤–æ–¥ –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞.

    Args:
        path (Path): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

    Returns:
        int: UNIXtime –ø–æ—Å–ª–µ–¥–Ω–µ–π —É–¥–∞—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
    """
    try:
        with open(path) as f:
            return int(f.read())
    except (ValueError, FileNotFoundError):
        return 0

def get_status_message(sp: SPMessages, timetag_path: Path) -> str:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ —Å–æ—Å–æ–±—â–µ–Ω–∏–µ –æ —Ä–∞–±–æ—Ç–∞ –±–æ—Ç–∞ –∏ –ø–∞—Ä—Å–µ—Ä–∞.

    –ò–Ω—Ñ–æ–º–∞—Ä—Ü–∏–æ–Ω–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ç–æ—Ä—É—é –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é
    –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–∞–±–æ—Ç–∞—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞.
    –ö –ø—Ä–∏–º–µ—Ä—É –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞, –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è,
    –∫–ª–∞—Å—Å–æ–≤ –∏ –ø—Ä–æ—á–µ–µ.

    Args:
        sp (SPMessages): –≠–∫–∑–µ–º–ø–ª—è—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
        timetag_path (Path): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

    Returns:
        str: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    """
    message = sp.send_status()
    message += "\n‚öôÔ∏è –í–µ—Ä—Å–∏—è –±–æ—Ç–∞: 2.2\nüõ†Ô∏è –¢–µ—Å—Ç–µ—Ä @sp6510"

    timetag = get_update_timetag(timetag_path)
    timedelta = datetime.now().timestamp() - timetag
    message += f"\nüìÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ {get_str_timedelta(timedelta)} –Ω–∞–∑–∞–¥"

    if timedelta > 3600:
        message += ("\n‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –±–æ–ª–µ–µ —á–∞—Å–∞ –Ω–∞–∑–∞–¥."
            "\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –±–æ—Ç–∞."
        )

    return message


def get_home_message(cl: str) -> str:
    """–û—Ç–ø—Ä–∞–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞.

    –ì–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞.
    –û–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∞—Ç–∫—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

    –í —à–∞–ø–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–∞—à –∫–ª–∞—Å—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    –í —Ç–µ–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞.
    –ï—Å–ª–∏ –≤—ã –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–ª–∞—Å—Å—É, —Å–ø—Ä–∞–≤–∫–∞ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è.

    Args:
        cl (str): –î–ª—è –∫–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.

    Returns:
        str: –ì–æ—Ç–æ–≤–æ–µ –≥–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞.
    """
    if cl:
        message = f"üíé –í–∞—à –∫–ª–∞—Å—Å {cl}"
    else:
        message = f"üåü –í—ã –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–ª–∞—Å—Å—É."

    message += f"\n\n{HOME_MESSAGE}"
    return message

def get_notify_message(enabled: bool, hours: list[int]) -> str:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

    –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ:
    –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —Å–µ–π—á–∞—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ–º—Ä–∞—Ü–∏—è –æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω—è—Ö.
    –í –∫–∞–∫–∏–µ —á–∞—Å—ã —Ä–∞—Å—Å—ã–ª–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤.

    Args:
        enabled (bool): –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        hours (list[int]): –í –∫–∞–∫–∏–µ —á–∞—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.
    """
    if enabled:
        message = ("üîî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã."
            "\n–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è."
            "\n\n–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."
            "\n–í —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞."
        )
        if len(hours) > 0:
            message += "\n\n–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤: "
            message += ", ".join(map(str, set(hours)))
    else:
        message = "üîï —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã.\n–ù–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π."

    return message

def get_counter_message(
    sc: Schedule, counter: str, target: str, intent: Optional[Intent]=None
) -> str:
    """–°–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞–±–æ—Ç—ã —Å—á—ë—Ç—á–∏–∫–æ–≤.

    –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é
    —Ñ—É–Ω–∫—Ü–∏—é —Å—á—ë—Ç—á–∏–∫–∞.

    +----------+-------------------------+
    | counter  | targets                 |
    +----------+-------------------------+
    | cl       | days, lessons. cabinets |
    | days     | cl, lessons. cabinets   |
    | lessons  | cl, days. main          |
    | cabinets | cl, days. main          |
    +----------+-------------------------+

    Args:
        sc (Schedule): –≠–∫–∑–µ–º–ø–ª—è—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤.
        counter (str): –¢–∏–ø —Å—á—ë—Ç—á–∏–∫–∞.
        target (str): –ì—Ä—É–ø–ø–∞ –ø—Ä–æ—Å–º—Ç–æ—Ä–∞ —Å—á—ë—Ç—á–∏–∫–∞.
        intent (Intent): –ù–∞–º–µ—Ä–µ–Ω–∏–µ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å—á—ë—Ç—á–∏–∫–∞.

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞–∞—Ç–º–∏ —Å—á—ë—Ç—á–∏–∫–∞.
    """
    message = f"‚ú® –°—á—ë—Ç—á–∏–∫ {counter}/{target}:"
    if intent is not None:
        message += f"\n‚öôÔ∏è {get_intent_status(intent)}"
    else:
        intent = Intent()

    if counter == "cl":
        if target == "lessons":
            intent = intent.reconstruct(sc, cl=sc.cl)
        res = cl_counter(sc, intent)
    elif counter == "days":
        res = days_counter(sc, intent)
    elif counter == "lessons":
        res = index_counter(sc, intent)
    else:
        res = index_counter(sc, intent, cabinets_mode=True)

    if target == "none":
        target = None

    message += send_counter(group_counter_res(res), target=target)
    return message

def get_updates_message(
    update: Optional[list]=None, cl: Optional[str]=None,
    intent: Optional[Intent]=None
) -> str:
    """–°–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    Args:
        update (list, Optional): –°—Ç—Ä–∞–Ω—Ü–∏–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
        cl (str, Optional): –î–ª—è –∫–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è.
        intent (Intent, Optional): –ù–∞–º–µ—Ä–µ–Ω–∏–µ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    """
    message = "üîî –ò–∑–º–µ–Ω–µ–Ω–∏—è "
    message += " –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏:\n" if cl is None else f" –¥–ª—è {cl}:\n"
    if intent is not None:
        message += f"‚öôÔ∏è {get_intent_status(intent)}\n"

    if update is not None:
        update_text = send_update(update, cl=cl)

        if len(update_text) > 4000:
            message += "\nüìö –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π."
        else:
            message += update_text
    else:
        message += "‚ú® –ù–µ—Ç –Ω–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π."

    return message

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π ----------------------------------------------------------

def get_intent_info(name: str, i: Intent) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

    Args:
        name (str): –ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
        i (Intent): –≠–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

    Returns:
        str: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–º–µ—Ä–µ–Ω–∏–∏."""
    return (f"‚öôÔ∏è –ù–∞–º–µ—Ä–µ–Ω–∏–µ \"{name}\":"
        f"\n\nüî∏ –ö–ª–∞—Å—Å—ã: {', '.join(i.cl)}"
        f"\nüî∏ –î–Ω–∏: {', '.join([days_names[x] for x in i.days])}"
        f"\nüî∏ –£—Ä–æ–∫–∏: {', '.join(i.lessons)}"
        f"\nüî∏ –ö–∞–±–∏–Ω–µ—Ç—ã: {', '.join(i.cabinets)}"
    )

def get_intents_message(intents: list[IntentObject]) -> str:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    –û–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ–±—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
    –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –Ω–∞–º–µ—Ä–µ–Ω–∏—è –∏ —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ.

    Args:
        intents (list[IntentObject]): –°–ø–∏—Å–æ–∫ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        str: –ì–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
    """
    Message = f"‚öôÔ∏è –í–∞—à–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.\n\n{INTENTS_INFO_MESSAGE}\n"

    if len(intents) == 0:
        Message += "\n\n–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–π."

    else:
        for x in intents:
            Message += f"\nüî∏ {x.name}: {get_intent_status(x.intent)}"

    if len(intents) < 9:
        Message += ("\n\n‚úèÔ∏è /add_intent - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ."
            "\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ."
        )

    return Message



# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
# ==================

# –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -------------------------------------------

@dp.message(Command("cl_features"))
async def restrictions_handler(message: Message) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–º—É—â–µ—Å—Ç–≤ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–ª–∞—Å—Å–µ."""
    await message.answer(text=CL_FEATURES_MESSAGE)

@dp.message(Command("tutorial"))
async def tutorial_handler(message: Message) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤."""
    await message.delete()
    await message.answer(
        text=TUTORIAL_MESSAGES[0],
        reply_markup=get_tutorial_keyboard(0)
    )

@dp.message(Command("info"))
async def info_handler(message: Message, sp: SPMessages) -> None:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —Ä–∞–±—Ç—ã –±–æ—Ç–∞ –∏ –ø–∞—Ä—Å–µ—Ä–∞."""
    await message.answer(
        text=get_status_message(sp, _TIMETAG_PATH),
        reply_markup=get_other_keyboard(sp.user["class_let"]),
    )

# Help –∫–æ–º–∞–Ω–¥–∞ ---------------------------------------------------------

@dp.message(Command("help", "start"))
async def start_handler(message: Message, sp: SPMessages) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–∫–∏ –∏ –≥–ª–∞–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.
    –ï—Å–ª–∏ –∫–ª–∞—Å—Å –Ω–µ —É–∫–∞–∑–∞–Ω, –æ—Ç–ø—Ä–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞."""
    await message.delete()
    if sp.user["set_class"]:
        await message.answer(
            text=get_home_message(sp.user["class_let"]),
            reply_markup=get_main_keyboard(sp.user["class_let"]),
        )
    else:
        await message.answer(text=SET_CLASS_MESSAGE, reply_markup=PASS_SET_CL_MARKUP)

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ----------------------------------------

@dp.message(Command("set_class"))
async def set_class_command(message: Message, sp: SPMessages,
    command: CommandObject
) -> None:
    """–ò–∑–º–µ–Ω—è–µ—Ç –∫–ª–∞—Å—Å –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ."""
    if command.args is not None:
        if sp.set_class(command.args):
            await message.answer(
                text=get_home_message(command.args),
                reply_markup=get_main_keyboard(command.args)
        )
        else:
            text = "üëÄ –¢–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
            text += f"\nüí° –î–æ—Å—Ç—É–ø–Ω—ãe –∫–ª–∞—Å—Å—ã: {', '.join(sp.sc.lessons)}"
            await message.answer(text=text)

    else:
        sp.reset_user()
        await message.answer(
            text=SET_CLASS_MESSAGE,
            reply_markup=PASS_SET_CL_MARKUP
        )

@dp.message(Command("pass"))
async def pass_handler(message: Message, sp: SPMessages) -> None:
    """–û—Ç–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –∫–ª–∞—Å—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."""
    sp.set_class(None)
    await message.answer(
        text=get_home_message(sp.user["class_let"]),
        reply_markup=get_main_keyboard(sp.user["class_let"]),
    )

# –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–∞–∑–¥–µ–ª–∞–º –±–æ—Ç–∞ ----------------------------------------------

@dp.message(Command("updates"))
async def updates_handler(message: Message, sp: SPMessages,
    intents: UserIntents
) -> None:
    """–û–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏."""
    updates = sp.sc.updates
    await message.answer(
        text=get_updates_message(updates[-1] if len(updates) else None),
        reply_markup=get_updates_keyboard(max(len(updates) - 1, 0),
            updates, None, intents
        )
    )

@dp.message(Command("counter"))
async def counter_handler(message: Message, sp: SPMessages,
    intents: UserIntents
) -> None:
    """–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ –º–µ–Ω—é –ø—Ä–æ—Å–º–æ—Ä–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."""
    await message.answer(
        text=get_counter_message(sp.sc, "lessons", "main"),
        reply_markup=get_counter_keyboard(sp.user["class_let"], "lessons", "main", intents),
    )

@dp.message(Command("notify"))
async def notify_handler(message: Message, sp: SPMessages):
    """–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ –º–µ–Ω—é—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π."""
    enabled = sp.user["notifications"]
    hours = sp.user["hours"]
    await message.answer(
        text=get_notify_message(enabled, hours),
        reply_markup=get_notify_keyboard(enabled, hours),
    )


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
# ===================

@dp.message(Command("cancel"))
async def cancel_handler(message: Message, state: FSMContext) -> None:
    """C–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π."""
    current_state = await state.get_state()
    if current_state is None:
        return

    await state.clear()
    await message.answer("–û—Ç–º–µ–Ω–µ–Ω–æ.")


class EditIntentStates(StatesGroup):
    name = State()
    parse = State()


class IntentCallback(CallbackData, prefix="intent"):
    action: str
    name: str


# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π ---------------------------------------------------

@dp.message(Command("intents"))
async def manage_intents_handler(message: Message,
    intents: UserIntents
) -> None:
    await message.answer(
        text=get_intents_message(intents.get()),
        reply_markup=get_intents_keyboard(intents.get())
    )

@dp.callback_query(F.data=="intents")
async def intents_callback(query: CallbackQuery, intents: UserIntents) -> None:
    await query.message.edit_text(
        text=get_intents_message(intents.get()),
        reply_markup=get_intents_keyboard(intents.get())
    )

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è --------------------------------------------------

@dp.callback_query(IntentCallback.filter(F.action=="add"))
async def add_intent_callback(query: CallbackQuery, state: FSMContext) -> None:
    await state.set_state(EditIntentStates.name)
    await query.message.edit_text(SET_INTENT_NAME_MESSAGE)

@dp.message(Command("add_intent"))
async def add_intent_handler(
    message: Message, state: FSMContext, intents: UserIntents
) -> None:
    # –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π
    if len(intents.get()) >= 9:
        await message.answer(INTENTS_LIMIT_MESSAGE,
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[[
            InlineKeyboardButton(
                text="üóëÔ∏è —É–¥–∞–ª–∏—Ç—å", callback_data="intents:remove_mode")
        ]]))
    else:
        await state.set_state(EditIntentStates.name)
        await message.answer(SET_INTENT_NAME_MESSAGE)

@dp.message(EditIntentStates.name)
async def intent_name_handler(message: Message, state: FSMContext) -> None:
    name = message.text.lower().strip()

    # –ï—Å–ª–∏ –¥–ª–∏–Ω–Ω–∞ –∏–º–µ–Ω–∏ –±–æ–ª—å—à–µ –∏–ª–∏ –º–µ–Ω—å—à–µ –Ω—É–∂–Ω–æ–π
    if len(name) < 3 or len(name) > 15:
        await message.answer("–ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3-—Ö –¥–æ 15-—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤.")

    else:
        await state.update_data(name=name)
        await state.set_state(EditIntentStates.parse)
        await message.answer(text=PARSE_INTENT_MESSAGE)

@dp.message(EditIntentStates.parse)
async def parse_intent_handler(
    message: Message, state: FSMContext, intents: UserIntents, sp: SPMessages
) -> None:
    i = Intent.parse(sp.sc, message.text.lower().strip().split())
    name = (await state.get_data())["name"]
    intents.add(name, i)
    await state.clear()
    await message.answer(
        text=get_intents_message(intents.get()),
        reply_markup=get_intents_keyboard(intents.get())
    )

# –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è ----------------------------------------------------

@dp.callback_query(IntentCallback.filter(F.action=="show"))
async def show_intent_callback(
    query: CallbackQuery, intents: UserIntents, callback_data: IntentCallback
) -> None:
    intent = intents.get_intent(callback_data.name)
    if intent is None:
        await query.message.edit_text(text="‚ö†Ô∏è –ù–µ–ø—Ä–∞–∏–≤–ª—å–Ω–æ–µ –∏–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è")
    else:
        await query.message.edit_text(
            text=get_intent_info(callback_data.name, intent),
            reply_markup=get_edit_intent_keyboard(callback_data.name)
        )

@dp.callback_query(IntentCallback.filter(F.action=="remove"))
async def show_intent_callback(
    query: CallbackQuery, intents: UserIntents, callback_data: IntentCallback
) -> None:
    intents.remove(callback_data.name)
    await query.message.edit_text(
        text=get_intents_message(intents.get()),
        reply_markup=get_intents_keyboard(intents.get())
    )

@dp.callback_query(IntentCallback.filter(F.action=="reparse"))
async def show_intent_callback(
    query: CallbackQuery, intents: UserIntents, callback_data: IntentCallback,
    state: FSMContext
) -> None:
    await state.set_state(EditIntentStates.parse)
    await state.update_data(name=callback_data.name)
    await query.message.edit_text(text=PARSE_INTENT_MESSAGE)


# –†–µ–∂–∏–º —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π -----------------------------------------------------

@dp.message(Command("remove_intents"))
async def intents_remove_mode_handler(
    message: Message, intents: UserIntents
) -> None:
    await message.answer(
        text=INTENTS_REMOVE_MANY_MESSAGE,
        reply_markup=get_remove_intents_keyboard(intents.get())
    )

@dp.callback_query(F.data=="intents:remove_mode")
async def intents_remove_mode_callback(
    query: CallbackQuery, intents: UserIntents
) -> None:
    await query.message.edit_text(
        text=INTENTS_REMOVE_MANY_MESSAGE,
        reply_markup=get_remove_intents_keyboard(intents.get())
    )

@dp.callback_query(IntentCallback.filter(F.action=="remove_many"))
async def show_intent_callback(
    query: CallbackQuery, intents: UserIntents, callback_data: IntentCallback
) -> None:
    intents.remove(callback_data.name)
    await query.message.edit_text(
        text=INTENTS_REMOVE_MANY_MESSAGE,
        reply_markup=get_remove_intents_keyboard(intents.get())
    )

@dp.callback_query(F.data=="intents:remove_all")
async def intents_set_remove_mode_callback(query: CallbackQuery, intents: UserIntents) -> None:
    intents.remove_all()
    await query.message.edit_text(
        text=get_intents_message(intents.get()),
        reply_markup=get_intents_keyboard(intents.get())
    )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
# =============================

def process_request(sp: SPMessages, request_text: str) -> Optional[str]:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç–µ–∫—Å—Ç –≤ –Ω–∞–±–æ—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏–ª–∏ –∑–∞–ø—Ä–æ—Å.
    –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø–æ–∏—Å–∫ –ø–æ —É—Ä–æ–∫–∞–º/–∫–∞–±–∏–Ω–µ—Ç–∞–º
    –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–π.

    Args:
        sp (SPMessages): –≠–∫–∑–µ–º–ø–ª—è—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
        request_text (str): –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

    Returns:
        str: –û—Ç–≤–µ—Ç –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
    """
    intent = Intent.parse(sp.sc, request_text.split())

    # –ß—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –±–æ—Ç–∞ –≤ –º–∞—à–∏–Ω—É –¥–ª—è —Å–ø–∞–º–∞
    # –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫/–∫–∞–±–∏–Ω–µ—Ç –∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞
    if len(intent.cabinets):
        res = sp.sc.search(list(intent.cabinets)[-1], intent, True)
        text = send_search_res(intent, res)

    elif len(intent.lessons):
        res = sp.sc.search(list(intent.lessons)[-1], intent, False)
        text = send_search_res(intent, res)

    elif intent.cl or intent.days:
        text = sp.send_lessons(intent) if intent.days else sp.send_today_lessons(intent)
    else:
        text = None

    return text

# –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ -------------------------------------------

@dp.message(Command("sc"))
async def sc_handler(message: Message, sp: SPMessages, command: CommandObject) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤—Ç–µ–ª—é.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∑–∞–∞–Ω –∫–ª–∞—Å—Å.
    """

    if command.args is not None:
        answer = process_request(sp, command.args)
        if answer is not None:
            await message.answer(text=answer)
        else:
            await message.answer(text="üëÄ –ö–∞–∂–µ—Ç—Å—è —ç—Ç–æ –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å...")

    elif sp.user["class_let"]:
        await message.answer(
            text=sp.send_today_lessons(Intent()),
            reply_markup=get_week_keyboard(sp.user["class_let"]),
        )
    else:
        await message.answer(
            text="‚ö†Ô∏è –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤–∞–º –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å."
        )

@dp.message()
async def main_handler(message: Message, sp: SPMessages) -> None:
    """–ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞.
    –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç–µ–∫—Å—Ç –≤ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
    –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞–ª—Å—Å, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
    """
    if message.text is None:
        return

    text = message.text.strip().lower()

    # –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–∫ –∫–ª–∞—Å—Å -> —Å–æ–∑–¥–∞—ë–º –∑–∞–ø—Ä–æ—Å
    if sp.user["set_class"]:
        answer = process_request(sp, text)

        if answer is not None:
            await message.answer(text=answer)
        elif message.chat.type == "private":
            await message.answer(text="üëÄ –ö–∞–∂–µ—Ç—Å—è —ç—Ç–æ –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å...")

    elif text in sp.sc.lessons:
        logger.info("Set class {}", text)
        sp.set_class(text)
        await message.answer(
            text=get_home_message(sp.user["class_let"]),
            reply_markup=get_main_keyboard(sp.user["class_let"])
        )

    elif message.chat.type == "private":
        text = "üëÄ –¢–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
        text += f"\nüí° –î–æ—Å—Ç—É–ø–Ω—ãe –∫–ª–∞—Å—Å—ã: {', '.join(sp.sc.lessons)}"
        await message.answer(text=text)


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Callback –∑–∞–ø—Ä–æ—Å–æ–≤
# ============================

@dp.callback_query(F.data == "delete_msg")
async def delete_msg_callback(query: CallbackQuery) -> None:
    await query.message.delete()

@dp.callback_query(F.data == "home")
async def home_callback(query: CallbackQuery, sp: SPMessages) -> None:
    """–í–æ–∑–∞—Ä–∞—â–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é."""
    await query.message.edit_text(
        text=get_home_message(sp.user["class_let"]),
        reply_markup=get_main_keyboard(sp.user["class_let"])
    )

@dp.callback_query(F.data == "other")
async def other_callback(query: CallbackQuery, sp: SPMessages) -> None:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –¥–æ–ø–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É."""
    await query.message.edit_text(
        text=get_status_message(sp, _TIMETAG_PATH),
        reply_markup=get_other_keyboard(sp.user["class_let"]),
    )

@dp.callback_query(F.data == "cl_features")
async def restrictions_callback(query: CallbackQuery) -> None:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞."""
    await query.message.edit_text(
        text=CL_FEATURES_MESSAGE, reply_markup=BACK_SET_CL_MARKUP
    )

@dp.callback_query(F.data == "set_class")
async def set_class_callback(query: CallbackQuery, sp: SPMessages) -> None:
    """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    sp.reset_user()
    await query.message.edit_text(
        text=SET_CLASS_MESSAGE, reply_markup=PASS_SET_CL_MARKUP
    )

@dp.callback_query(F.data == "pass")
async def pass_class_callback(query: CallbackData, sp: SPMessages) -> None:
    """–û—Ç–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –∫–ª–∞—Å—Å–∞."""
    sp.set_class(None)
    await query.message.edit_text(
        text=get_home_message(sp.user["class_let"]),
        reply_markup=get_main_keyboard(sp.user["class_let"])
    )


class ScCallback(CallbackData, prefix="sc"):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    cl (str): –ö–ª–∞—Å—Å –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
    day (str): –î–ª—è –∫–∞–∫–æ–≥–æ –¥–Ω—è –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

    - 0-5: –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - —Å—É–±–±–æ—Ç–∞.
    - today: –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞.
    - week: –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é."""
    cl: str
    day: str

@dp.callback_query(ScCallback.filter())
async def sc_callback(
    query: CallbackQuery, callback_data: ScCallback, sp: SPMessages
) -> None:
    """–û—Ç–ø–∞—Ä–≤–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –¥–µ–Ω—å."""
    if callback_data.day == "week":
        text = sp.send_lessons(
            Intent.construct(sp.sc, days=[0, 1, 2, 3, 4, 5], cl=callback_data.cl)
        )
        reply_markup = get_sc_keyboard(callback_data.cl)
    elif callback_data.day == "today":
        text = sp.send_today_lessons(Intent.construct(sp.sc, cl=callback_data.cl))
        reply_markup = get_week_keyboard(callback_data.cl)
    else:
        text = sp.send_lessons(
            Intent.construct(sp.sc, cl=callback_data.cl, days=int(callback_data.day))
        )
        reply_markup = get_week_keyboard(callback_data.cl)

    await query.message.edit_text(text=text, reply_markup=reply_markup)


class SelectDayCallback(CallbackData, prefix="select_day"):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    cl (str): –î–ª—è –∫–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
    """
    cl: str

@dp.callback_query(SelectDayCallback.filter())
async def select_day_callback(
    query: CallbackQuery, callback_data: ScCallback, sp: SPMessages
) -> None:
    """–û—Ç–æ–±—Ä–∂–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–Ω—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤."""
    await query.message.edit_text(
        text=f"üìÖ –Ω–∞ ...\nüî∂ –î–ª—è {callback_data.cl}:",
        reply_markup=get_select_day_keyboard(callback_data.cl),
    )


class NotifyCallback(CallbackData, prefix="notify"):
    """–ò—Å–ø–æ–ª—å—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    action (str): –ö–∞–∫–æ–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ: add, remove, on, off.
    hour (int): –î–ª—è –∫–∞–∫–æ–≥–æ —á–∞—Å–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ.

    - on: –í–∫–ª—é—á–∏—Ç—å —É–≤–¥–æ–º–ª–µ–Ω–∏—è.
    - off: –û—Ç–∫–ø–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    - add: –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Å.
    - remove: –û—Ç–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Å.
    """
    action: str
    hour: int

@dp.callback_query(F.data == "notify")
async def notify_callback(query: CallbackQuery, sp: SPMessages) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–¥–µ–æ–º–ª–µ–Ω–∏–π."""
    enabled = sp.user["notifications"]
    hours = sp.user["hours"]
    await query.message.edit_text(
        text=get_notify_message(enabled, hours),
        reply_markup=get_notify_keyboard(enabled, hours),
    )

@dp.callback_query(NotifyCallback.filter())
async def notify_mod_callback(
    query: CallbackQuery, sp: SPMessages, callback_data: NotifyCallback
) -> None:
    """–ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º."""
    if callback_data.action == "on":
        sp.user["notifications"] = True

    elif callback_data.action == "off":
        sp.user["notifications"] = False

    elif callback_data.action == "add":
        if callback_data.hour not in sp.user["hours"]:
            sp.user["hours"].append(callback_data.hour)

    elif callback_data.action == "remove":
        if callback_data.hour in sp.user["hours"]:
            sp.user["hours"].remove(callback_data.hour)

    elif callback_data.action == "reset":
        sp.user["hours"] = []

    sp.save_user()
    enabled = sp.user["notifications"]
    hours = sp.user["hours"]

    await query.message.edit_text(
        text=get_notify_message(enabled, hours),
        reply_markup=get_notify_keyboard(enabled, hours),
    )


class UpdatesCallback(CallbackData, prefix="updates"):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

    action (str): back, mext, last, switch.

    - back: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—Å—å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞–∑–∞–¥.
    - next: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–ø–µ—Ä—ë–¥.
    - last: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
    - swith: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å –æ–±—â–µ–≥–æ –Ω–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞.

    page (int): –¢–µ–∫—É—â–∞—é —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    cl (str): –î–ª—è –∫–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    intent (str): –ò–º—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    action: str
    page: int
    cl: str
    intent: str

@dp.callback_query(UpdatesCallback.filter())
async def updates_callback(
    query: CallbackQuery, sp: SPMessages, callback_data: UpdatesCallback,
    intents: UserIntents
) -> None:
    # –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∞—Å—Å–∞/–≤—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–Ω–∏—è
    if callback_data.action == "switch":
        cl = sp.user["class_let"] if callback_data.cl == "None" else None
    else:
        cl = None if callback_data.cl == "None" else callback_data.cl

    intent = intents.get_intent(callback_data.intent)

    if cl is not None and sp.user["class_let"]:
        intent = Intent.construct(sp.sc, cl)

    if intent is None:
        updates = sp.sc.updates
    else:
        updates = sp.sc.get_updates(intent)
    i = max(min(int(callback_data.page), len(updates) - 1), 0)

    if len(updates):
        if callback_data.action in ("last", "switch"):
            i = len(updates) - 1

        elif callback_data.action == "next":
            i = (i + 1) % len(updates)

        elif callback_data.action == "back":
            i = (i - 1) % len(updates)

        update = updates[i]
    else:
        update = None

    await query.message.edit_text(
        text=get_updates_message(update, cl, intent),
        reply_markup=get_updates_keyboard(
            i, updates, cl, intents, callback_data.intent
        )
    )


class CounterCallback(CallbackData, prefix="count"):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

    counter (str): –¢–∏–ø —Å—á—ë—Ç—á–∏–∫–∞.
    target (str): –¶–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–∞.
    intent (str): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

    +----------+-------------------------+
    | counter  | targets                 |
    +----------+-------------------------+
    | cl       | days, lessons. cabinets |
    | days     | cl, lessons. cabinets   |
    | lessons  | cl, days, main          |
    | cabinets | cl, days, main          |
    +----------+-------------------------+
    """
    counter: str
    target: str
    intent: str

@dp.callback_query(CounterCallback.filter())
async def counter_callback(
    query: CallbackQuery, sp: SPMessages, callback_data: NotifyCallback,
    intents: UserIntents
) -> None:
    """–ö–ª–∞–≤–∏—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."""
    counter = callback_data.counter
    target = callback_data.target

    if counter == target:
        target = None

    if counter == "cl" and target == "lessons" and not sp.user["class_let"]:
        target = None

    intent = intents.get_intent(callback_data.intent)

    await query.message.edit_text(
        text=get_counter_message(sp.sc, counter, target, intent),
        reply_markup=get_counter_keyboard(sp.user["class_let"], counter, target, intents, callback_data.intent),
    )


class TutorlailCallback(CallbackData, prefix="tutorial"):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π —Å–ø—Ä–∞–≤–∫–∏.

    page (int): –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø—Ä–∞–≤–∫–∏.
    """
    page: int

@dp.callback_query(TutorlailCallback.filter())
async def tutorail_callback(query: CallbackQuery,
    callback_data: TutorlailCallback) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è."""
    await query.message.edit_text(
        text=TUTORIAL_MESSAGES[callback_data.page],
        reply_markup=get_tutorial_keyboard(callback_data.page)
    )


@dp.callback_query()
async def callback_handler(query: CallbackQuery) -> None:
    """–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—á–∏–µ callback_data."""
    logger.warning("Unprocessed query - {}", query.data)


@dp.errors()
async def error_handler(exception: ErrorEvent) -> None:
    logger.exception(exception.exception)


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
# ===========

async def main() -> None:
    bot = Bot(TELEGRAM_TOKEN)
    logger.info("Bot started.")
    await dp.start_polling(bot, skip_updates=True)


if __name__ == "__main__":
    asyncio.run(main())
