"""
C–æ–æ–±—â–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –±–æ—Ç–µ.

Author: Milinuri Nirvalen
"""

from sp.spm import send_counter
from sp.spm import SPMessages
from sp.parser import Schedule
from sp.filters import construct_filters

# –°—á—ë—Ç—á–∏–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
from sp.counters import cl_counter
from sp.counters import days_counter
from sp.counters import group_counter_res
from sp.counters import index_counter



HOME = """üí° –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
-- 7–≤ 6–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
-- —É—Ä–æ–∫–∏ 6–∞ –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫ —Å—Ä
-- —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –¥–ª—è 8–±
-- 312 –Ω–∞ –≤—Ç–æ—Ä–Ω–∏–∫ –ø—è—Ç–Ω–∏—Ü—É
-- —Ö–∏–º–∏—è 228 6–∞ –≤—Ç–æ—Ä–Ω–∏–∫

üè´ –í –∑–∞–ø—Ä–æ—Å–∞—Ö –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
–£—Ä–æ–∫/–ö–∞–±–∏–Ω–µ—Ç: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è.

–ö–ª–∞—Å—Å—ã: –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
-- –ï—Å–ª–∏ –∫–ª–∞—Å—Å –Ω–µ —É–∫–∑–∞–∞–Ω, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤–∞—à –∫–ª–∞—Å—Å.
-- "?": –¥–ª—è —è–≤–Ω–æ–π –ø–æ–¥—Å—Ç–∞–≤–Ω–æ–≤–∫–∏ –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞.

–î–Ω–∏ –Ω–µ–¥–µ–ª–∏:
-- –ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ —É–∫–∞–∑–∞–Ω - –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞.
-- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-—Å—É–±–±–æ—Ç–∞ (–ø–Ω-—Å–±).
-- –°–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –Ω–µ–¥–µ–ª—è.

üåü –ü–æ—Ä—è–¥–æ–∫ –∏ —Ñ–æ—Ä–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–µ –≤–∞–∂–Ω—ã, –±–∞–ª—É–π—Ç–µ—Å—å!"""


INFO = """
üå≤ –í–µ—Ä—Å–∏—è –±–æ—Ç–∞: 1.0 (9)"""


SET_CLASS = """
–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤–∞—à –∫–ª–∞—Å—Å.
–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

üåü –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –∫–æ–º–∞–Ω–¥–æ–π /pass.
–ù–æ —ç—Ç–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
–ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö –º–æ–∂–Ω–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ /restrictions.

–°–ø–æ—Å–æ–±—ã —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å:
-- (–í –ø–µ—Ä–µ–ø–∏—Å–∫–µ —Å –±–æ—Ç–æ–º) –°–ª–µ–¥—É—é—à–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–ª–∞—Å—Å ("1–∞").
-- /set_class –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞—Å—Å–æ–º ("7–∞").
-- /set_class [–∫–ª–∞—Å—Å] -- —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞.

üí° –í—ã –º–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º:
-- –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /set_class.
-- –ß–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É C–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å."""


RESTRICTIONS = """–í—Å—ë –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ:

-- –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∫–ª–∞—Å—Å–∞.
-- –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Å–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö.
-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–ª–∞—Å—Å–∞.
-- –°—á—ë—Ç—á–∏–∫ "–ø–æ –∫–ª–∞—Å—Å–∞–º/—É—Ä–æ–∫–∏".
-- –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

üåü –ù–∞ —ç—Ç–æ–º –≤—Å–µ –æ—Ç–ª–∏—á–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è."""


def send_home_message(sp: SPMessages) -> str:
    """–û—Ç–ø–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø—Ä–∞–≤–∫–æ–π –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞.

    Args:
        sp (SPMessages): –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

    Returns:
        str: –ì–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    cl = sp.user["class_let"]

    if cl:
        message = f"üíé –í–∞—à –∫–ª–∞—Å—Å {cl}."
    elif sp.user["set_class"]:
        message = "üåü –í—ã –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–ª–∞—Å—Å—É."
    else:
        message = "üëÄ –•–∏—Ç—Ä–æ, –Ω–æ —Ç–∞–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç."
        message += "\nüí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: /set_class"

    message += "\n\n"
    message += HOME

    return message

def send_notifications_info(sp: SPMessages) -> str:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.

    Args:
        sp (SPMessages): –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.
    """

    message = "–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è.\n"

    if sp.user["notifications"]:
        message += "\nüîî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã."
        message += "\n\n–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."
        message += "\n–í —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞."
        hours = sp.user["hours"]

        if hours:
            message += "\n\n–†–∞—Å–ø–∏—Å–∞–Ω–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤: "
            message += ", ".join(map(str, set(hours)))
    else:
        message += "\nüîï —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã."

    return message

def send_counter_message(sc: Schedule, counter: str, target: str) -> str:
    """–°–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞–±–æ—Ç—ã —Å—á—ë—Ç—á–∏–∫–æ–≤.

    Args:
        sc (Schedule): –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤
        counter (str): –¢–∏–ø —Å—á—ë—Ç—á–∏–∫–∞
        target (str): –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á—ë—Ç—á–∏–∫–∞

    Returns:
        str: –ì–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """

    flt = construct_filters(sc)

    if counter == "cl":
        if target == "lessons":
            flt = construct_filters(sc, cl=sc.cl)
        res = cl_counter(sc, flt)
    elif counter == "days":
        res = days_counter(sc, flt)
    elif counter == "lessons":
        res = index_counter(sc, flt)
    else:
        res = index_counter(sc, flt, cabinets_mode=True)

    groups = group_counter_res(res)
    message = f"‚ú® –°—á—ë—Ç—á–∏–∫ {counter}/{target}:"
    message += send_counter(groups, target=target)
    return message
