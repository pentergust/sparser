# Tparser

> Парсер школьного расписания.

Сколько времени уходит, чтобы просто посмотреть какие уроки на завтра?
Для начала нужно найти ссылку на расписание, хорошо. если она лежит в закладках.
Потом ожидание пока расписание загрузится, поиск своего класс и наконец...

**Это долго!**

В этом репозитории находится мой парсер `tparser.py`,
лёгкая обёртка для парсера `console.py` в консоли,
бот для **Telegram** и **плагин для Чио**.

Надеюсь это кому-нибудь пригодится.

Добавлена поддержка `cpm`:

```sh
# Добавляем репозиторий tparser в cpm
echo "\n[tparser]\nurl = \"https://notabug.org/pentergust/tparser/raw/master/\"" >> cpm_data/repositories.toml

# Устанавливаем парсер расписания
python cpm update
python cpm install tparser/main
```

## О парсере

Главным образом парсер преобразует CSV файо расписания в удобный для использования формат.

Выходной файл содержит:

- Общий хеш расписания
- В какой час было последнее обновление (0-23)
- Словарь для каждого класса
- В словаре класса содержится список из 6 дней
- В каждом дне есть хеш и список уроков на день

Чтобы не парсить расписание каждый раз, оно сохраняется в `sc.json`.
Раз в час происходит загрузка расписания и если их хеши различаются - обновляется.

Парсер запоминает плльзователей по UID (User ID) и хранит данные пользоватеей в `users.json`.
В данных пользователя находится указанный ими класс и хеши списка уроков на каждый день.
Если расписание для выбранного пользователем класса изменилось, парсер оповестит пользователя.


## Console

Поддерживает все 100% возможностей парсера.
Поставляется вместе с парсером, для примера реализации его использования.

```sh
# Получить расписание для класа по умолчанию на завтра
python tparser/console.py

# Вывести справку по командам
python tparser/console.py help
```


## Telegram

Бота написал Артём Березин, спасибо.
Всё происходит через клавиатуру бота и разобраться с ней труда не составит.

**Ограничения**: 

- Посмотреть расписание для другого класса не сменив класс по умолчванию нельзя
- Разработка бота для парсера затруднена т.к. у меня нету Telegram

```sh
python cpm install tparser.tparser/telegram
```

## Chio Plugin

Для взаимодействия с парсером можно использовать плагин для Чио.
Плагин не привязан к движку и может использовать все возможности парсера.

```sh
python cpm install tparser.packages/schedule
```

У плагина всего **2 команды**:

- `/класс [class_let]`: Изменить класс по умолчанию на `class_let`
- `/уроки [args]`: Получить расписание
  - Если аргументы не указаны, получаем уроки на завтра для класса по умолчанию
  - Если указан класс, получаем уроки для выбранного класса
  - Если указан день недели, получаем уроки на этот день
  - Комбинировать аргументы можно как душе угодно
