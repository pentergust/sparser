# Tparser

> Парсер школьного расписания.

Сколько времени уходит, чтобы просто посмотреть какие уроки на завтра?
Для начала нужно найти ссылку на расписание, хорошо если она лежит в закладках.
Потом ожидание пока расписание загрузится, поиск своего класса и наконец...

**Это долго!**

Итак, в этом репозитории:

- Парсер школьного расписания.
- **Консольный скрипт** для отладки и примера использования.
- Маленький **Telegram** бот.
- **Пллагин для Чио**, чтобы развернуть бота в **ВК**.

Главная цель проекта - максимальное **быстрое и удобное** получения расписания.


Добавлена поддержка `cpm`.
Больше о `cpm` и как им пользоваться описано в его репозитории.

```sh
# Добавляем репозиторий tparser в cpm
echo "\n[tparser]\nurl = \"https://notabug.org/pentergust/tparser/raw/master/\"" >> cpm_data/repositories.toml

# Устанавливаем парсер расписания
python cpm update
python cpm install tparser/parser
```


## О парсере

Парсер занимается переработкой содержимого гугл таблиц в "удобный" для нас формат.

Если кратко: **Гугл таблицы** -> **CSV** файл -> пригодный **jsoт** файлм.

Выходной json файл содержит:

- Общий хеш расписания.
- В какой час была последняя проверка (0-23)
- Словарь уроков: {Класс: [{Уроки: [...] , Хеш: "AAA"}, {день 2}, ...]}
- Когда было последнее обновление расписания

Для повышения скорости результат работы парсера сохраняется в `sc.json`.
Раз в час происходит проверка обновлений в расписании, если есть - парсим.

Парсер запоминает пользователей в `users.json`.
Пользователи для удобства могут указать класс по умолчанию.
Пользователь может получит расписание для любого дня (дней) и класса.
Если расписание для пользователя изменилось, парсер сообщит об этом.


## Console

Поддерживает все 147% возможностей парсера.
Поставляется вместе с парсером.
Полезен для отладки и как пример использования парсера.
Ничего сложного в его использовании нету.

```sh
# Просмотр справки по командам
python tparser/console.py helpы
```


## Telegram

Оригинал бота написал Артём Березин, спасибо!
Всё происходит через клавиатуру бота и разобраться с ней труда не составит.

**Примечания**: 

- Разработка telegram бота затруднена т.к. у меня нету Telegram :).
- Получить расписание для другого класса не сменив класс по умолчванию не получится.
- Не получится получить расписание для нескольких дней. -> на всю неделю.
- Не добпалено умное расписание на сегодня/завтра.
- Всё остальное работает исправно на последней версии парсера.

```sh
# Установка (через cpm)
python cpm install tparser.tparser/telegram

# Запуск telegram бота
python tparser/telegram.py
```

## Chio Plugin

Поддерживаются 100% пасрера.
Конечно, для работы этого плагина вам нужна сама Чио.
Сам плагин не зависит от какого-либо движка.
Как установить и запустить Чио описано в её собственном репозитории.


```sh
# Установка плагина
python cpm install tparser.packages/schedule
```

У плагина всего **3 команды**:

- `/класс [class_let]`: Изменить класс по умолчанию на `class_let`.
- `/уроки [args]`: Получить расписание:
  - Если аргументы не указаны, получаем уроки на сегодня/завтра для класса по умолчанию.
  - Если указан класс, получаем уроки для выбранного класса.
  - Если указаны дни недели, получаем уроки на эти дни.
  - Комбинировать эти аргументы можно как вашей душе угодно.
